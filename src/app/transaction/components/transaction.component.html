<div class="transaction-app">
  <div class="header-section">
    <h1 class="app-title">Transactions</h1>
    <button class="add-btn" (click)="openAddTransactionDialog()">
      <span class="btn-icon">+</span>
      Add Transaction
    </button>
  </div>

  <!-- Add Transaction Modal -->
  <div *ngIf="showAddDialog" class="transaction-overlay" (click)="closeAddDialog()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ’° Add New Transaction</h2>
        <button type="button" class="close-btn" (click)="closeAddDialog()">
          Ã—
        </button>
      </div>

      <div class="modal-body">
        <form
          [formGroup]="transactionForm"
          (ngSubmit)="onAddTransaction()"
          class="transaction-form"
        >
          <div class="form-group">
            <label for="date" class="form-label">
              <span class="label-icon">ğŸ“…</span>
              Date
            </label>
            <input
              type="date"
              id="date"
              class="form-control"
              formControlName="date"
              [max]="currentDate"
            />
            <div
              *ngIf="
                transactionForm.get('date')?.invalid &&
                transactionForm.get('date')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Date is required
            </div>
          </div>

          <div class="form-group">
            <label for="description" class="form-label">
              <span class="label-icon">ğŸ“</span>
              Description
            </label>
            <input
              type="text"
              id="description"
              formControlName="description"
              class="form-control"
              [class.error]="
                transactionForm.get('description')?.invalid &&
                transactionForm.get('description')?.touched
              "
              placeholder="e.g., Groceries, Coffee, Gas"
            />
            <div
              *ngIf="
                transactionForm.get('description')?.invalid &&
                transactionForm.get('description')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Description is required
            </div>
          </div>

          <div class="form-group">
            <label for="amount" class="form-label">
              <span class="label-icon">ğŸ’µ</span>
              Amount
            </label>
            <div class="amount-input-wrapper">
              <span class="currency-symbol">$</span>
              <input
                type="number"
                id="amount"
                formControlName="amount"
                class="form-control amount-input"
                [class.error]="
                  transactionForm.get('amount')?.invalid &&
                  transactionForm.get('amount')?.touched
                "
                placeholder="0.00"
                step="0.01"
                min="0"
              />
            </div>
            <div
              *ngIf="
                transactionForm.get('amount')?.invalid &&
                transactionForm.get('amount')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Please enter a valid amount
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-cancel"
              (click)="closeAddDialog()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="!transactionForm.valid"
            >
              ğŸ’° Add Transaction
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Transaction Modal -->
  <div *ngIf="showEditDialog" class="transaction-overlay" (click)="closeEditDialog()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ’° Edit Transaction</h2>
        <button type="button" class="close-btn" (click)="closeEditDialog()">
          Ã—
        </button>
      </div>

      <div class="modal-body">
        <form
          [formGroup]="transactionForm"
          (ngSubmit)="onSaveEditedTransaction()"
          class="transaction-form"
        >
          <div class="form-group">
            <label for="date" class="form-label">
              <span class="label-icon">ğŸ“…</span>
              Date
            </label>
            <input
              type="date"
              id="date"
              class="form-control"
              formControlName="date"
              [max]="currentDate"
            />
            <div
              *ngIf="
                transactionForm.get('date')?.invalid &&
                transactionForm.get('date')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Date is required
            </div>
          </div>

          <div class="form-group">
            <label for="description" class="form-label">
              <span class="label-icon">ğŸ“</span>
              Description
            </label>
            <input
              type="text"
              id="description"
              formControlName="description"
              class="form-control"
              [class.error]="
                transactionForm.get('description')?.invalid &&
                transactionForm.get('description')?.touched
              "
              placeholder="e.g., Groceries, Coffee, Gas"
            />
            <div
              *ngIf="
                transactionForm.get('description')?.invalid &&
                transactionForm.get('description')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Description is required
            </div>
          </div>

          <div class="form-group">
            <label for="amount" class="form-label">
              <span class="label-icon">ğŸ’µ</span>
              Amount
            </label>
            <div class="amount-input-wrapper">
              <span class="currency-symbol">$</span>
              <input
                type="number"
                id="amount"
                formControlName="amount"
                class="form-control amount-input"
                [class.error]="
                  transactionForm.get('amount')?.invalid &&
                  transactionForm.get('amount')?.touched
                "
                placeholder="0.00"
                step="0.01"
                min="0"
              />
            </div>
            <div
              *ngIf="
                transactionForm.get('amount')?.invalid &&
                transactionForm.get('amount')?.touched
              "
              class="error-message"
            >
              <span class="error-icon">âš ï¸</span>
              Please enter a valid amount
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-cancel"
              (click)="closeEditDialog()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="!transactionForm.valid"
            >
              ğŸ’° Edit Transaction
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Transactions Section -->
  <div class="transactions-section">
    <div class="header-section">
      <h2 class="section-title">This Month's Transactions</h2>
      <button class="btn-show-all" (click)="openAllTransactionsDialog()">Show All Transactions</button>
    </div>

    <div *ngIf="allTransactions.length === 0" class="no-transactions">
      <div class="empty-state">
        <div class="empty-icon">ğŸ’³</div>
        <h3>No transactions yet</h3>
        <p>Start by adding your first transaction above!</p>
      </div>
    </div>

    <div class="transactions-container" *ngIf="allTransactions.length > 0">
      <div
        *ngFor="let transaction of monthTransactions; let i = index"
        class="transaction-card"
      >
        <div class="transaction-content">
          <div class="transaction-left">
            <div class="transaction-icon">ğŸ’°</div>
            <div class="transaction-details">
              <h4 class="transaction-description">
                {{ transaction.description }}
              </h4>
              <p class="transaction-date">
                {{ transaction.date | date : "fullDate" }}
              </p>
            </div>
          </div>
          <div class="transaction-right">
            <div class="transaction-amount">
              ${{ transaction.amount | number : "1.2-2" }}
            </div>

            <button class="btn-edit" (click)="editTransaction(transaction)">Edit</button>
            <button class="btn-delete" (click)="onDeleteTransaction(transaction)">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Show All Transactions Modal -->
  <div *ngIf="showAllTransactionDialog" class="transaction-overlay" (click)="closeAllTransactionsDialog()">
    <div class="modal-container large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ“‹ All Transactions</h2>
        <button type="button" class="close-btn" (click)="closeAllTransactionsDialog()">Ã—</button>
      </div>

      <div class="modal-body scrollable">
        <div *ngIf="allTransactions.length === 0" class="no-transactions">
          <div class="empty-state">
            <div class="empty-icon">ğŸ’³</div>
            <h3>No transactions available</h3>
            <p>There are no transactions to display.</p>
          </div>
        </div>

        <div *ngIf="allTransactions.length > 0" class="transactions-container">
          <div
            *ngFor="let transaction of allTransactions; let i = index"
            class="transaction-card"
          >
            <div class="transaction-content">
              <div class="transaction-left">
                <div class="transaction-icon">ğŸ’°</div>
                <div class="transaction-details">
                  <h4 class="transaction-description">
                    {{ transaction.description }}
                  </h4>
                  <p class="transaction-date">
                    {{ transaction.date | date : "fullDate" }}
                  </p>
                </div>
              </div>
              <div class="transaction-right">
                <div class="transaction-amount">
                  ${{ transaction.amount | number : "1.2-2" }}
                </div>
                <button class="btn-edit" (click)="editTransaction(transaction); showAllTransactionDialog = false">Edit</button>
                <button class="btn-delete" (click)="onDeleteTransaction(transaction)">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-cancel" (click)="closeAllTransactionsDialog()">Close</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteDialog" class="transaction-overlay" (click)="onCloseDeleteDialog()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ—‘ï¸ Delete Transaction</h2>
        <button type="button" class="close-btn" (click)="onCloseDeleteDialog()">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="delete-confirmation">
          <div class="warning-icon">âš ï¸</div>
          <h3>Are you sure?</h3>
          <p>This action cannot be undone. The transaction "{{ transactionToDelete?.description }}" will be permanently deleted.</p>
          
          <div class="form-actions">
            <button type="button" class="btn btn-cancel" (click)="onCloseDeleteDialog()">Cancel</button>
            <button type="button" class="btn-delete" (click)="deleteTransaction(transactionToDelete?.id)">ğŸ—‘ï¸ Delete Transaction</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
